<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Samba over Tailscale/Wireguard [Old] | (no title)</title><meta name=keywords content="server,samba,tailscale,wireguard"><meta name=description content="I recently found out about Tailscale, a control plane for WireGuard. I decided to revisit an old project of mine and use it to set up a Samba server on an long ignored dedicated server so that I could access my videos remotely. However, the process proved to be more challenging than I had anticipated.
Goal The goal was to access my videos from the server via my Windows PC and Android phone, while also ensuring that the data was secure in transit, and not accessed by others."><meta name=author content="Hartman"><link rel=canonical href=https://hartmantam.xyz/hidden/samba-over-tailscale-wireguard-old/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://hartmantam.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://hartmantam.xyz/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hartmantam.xyz/favicon-32x32.png><link rel=apple-touch-icon href=https://hartmantam.xyz/apple-touch-icon.png><link rel=mask-icon href=https://hartmantam.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Samba over Tailscale/Wireguard [Old]"><meta property="og:description" content="I recently found out about Tailscale, a control plane for WireGuard. I decided to revisit an old project of mine and use it to set up a Samba server on an long ignored dedicated server so that I could access my videos remotely. However, the process proved to be more challenging than I had anticipated.
Goal The goal was to access my videos from the server via my Windows PC and Android phone, while also ensuring that the data was secure in transit, and not accessed by others."><meta property="og:type" content="article"><meta property="og:url" content="https://hartmantam.xyz/hidden/samba-over-tailscale-wireguard-old/"><meta property="article:section" content="hidden"><meta property="article:published_time" content="2023-01-04T18:14:39+00:00"><meta property="article:modified_time" content="2023-01-04T18:14:39+00:00"><meta property="og:site_name" content="(no title)"><meta name=twitter:card content="summary"><meta name=twitter:title content="Samba over Tailscale/Wireguard [Old]"><meta name=twitter:description content="I recently found out about Tailscale, a control plane for WireGuard. I decided to revisit an old project of mine and use it to set up a Samba server on an long ignored dedicated server so that I could access my videos remotely. However, the process proved to be more challenging than I had anticipated.
Goal The goal was to access my videos from the server via my Windows PC and Android phone, while also ensuring that the data was secure in transit, and not accessed by others."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Hiddens","item":"https://hartmantam.xyz/hidden/"},{"@type":"ListItem","position":2,"name":"Samba over Tailscale/Wireguard [Old]","item":"https://hartmantam.xyz/hidden/samba-over-tailscale-wireguard-old/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Samba over Tailscale/Wireguard [Old]","name":"Samba over Tailscale\/Wireguard [Old]","description":"I recently found out about Tailscale, a control plane for WireGuard. I decided to revisit an old project of mine and use it to set up a Samba server on an long ignored dedicated server so that I could access my videos remotely. However, the process proved to be more challenging than I had anticipated.\nGoal The goal was to access my videos from the server via my Windows PC and Android phone, while also ensuring that the data was secure in transit, and not accessed by others.","keywords":["server","samba","tailscale","wireguard"],"articleBody":"I recently found out about Tailscale, a control plane for WireGuard. I decided to revisit an old project of mine and use it to set up a Samba server on an long ignored dedicated server so that I could access my videos remotely. However, the process proved to be more challenging than I had anticipated.\nGoal The goal was to access my videos from the server via my Windows PC and Android phone, while also ensuring that the data was secure in transit, and not accessed by others. On my PC, I planned to use Windows’ native SMB support. On my Android phone, I intended to use the MX Player app to access the videos.\nProblem One of the main reasons I initially chose not to serve SMB over the internet was due to security concerns. While SMB is commonly used in LAN, it is not designed for use over the internet and may not provide adequate security when used in this manner. Additionally, the Android app I’m using only supports SMB, so I had no other choice but to use it.\nSolution The solution I came up with was to tunnel all Samba traffic through Tailnet, the WireGuard network managed by Tailscale. This way, I could benefit from the security provided by WireGuard and the authentication provided by Tailscale. Completing the goal of secure data in transit and authenticated access.\nAlternate Solution Another solution would have been to use a traditional VPN like OpenVPN, but this introduces a major drawback: all of my traffic would have to go through the VPN. While it is possible to use advanced configurations to avoid this issue, I did not have sufficient knowledge of networking to do so. When WireGuard first came out, I considered using it, but ultimately decided not to because I was unfamiliar with overlay networks and the work required to manage such a network.\nImplementation I won’t go into detail on the process of setting up Samba or Tailscale, as I am not an expert in Samba configuration and Tailscale have a easy to follow quick start.\nInitial Configuration After consulting the documentation, I believed the following configuration would be sufficient:\n[global] interfaces = lo tailnet0 # Listens on Tailscale and loopback interface bind interfaces only = yes # Only listen [share] path = /home/user/share read only = no valid user = user # Defense in depth, more layer protection is always better Debugging the Issue Unfortunately, this configuration did not work as expected. The Samba server did not bind to the Tailscale interface. Upon further investigation, I read a post on Unix StackExchange that Samba will not listen Wireguard interface unless IP and netmask are given. As a result, I modified the configuration as follows:\n[global] interfaces = lo 100.64.0.0/10 # 100.64.0.0/10 is the IP range that Tailscale assigns bind interfaces only = yes [share] path = /home/user/share read only = no valid user = user Sadly, this modification did not resolve the issue and the Samba server still did not listen. Despite spending two days trying to resolve the problem, I reread the documentation and discovered the following information regarding the bind interface only parameter:\n… Note that you should not use this parameter for machines that are serving PPP or other intermittent or non-broadcast network interfaces as it will not cope with non-permanent interfaces. …\nFinal Configuration This led me to realize that the bind interfaces only parameter was causing the issue. However, simply disabling it would cause the server to listen on every broadcast-capable interface in addition to the Tailscale interface.\nTo minimize the effect, I decided to use the hosts allow parameter to restrict access to only clients on the same Tailscale network and enable hidden share. However, this is not a perfect solution. Upon port scan, one can still see the server have Samba installed. People can still visit the root directory, although they can’t see any share. Still, I deemed it should be sufficient for meeting my goal.\nThe final configuration I used is shown below:\n[global] interfaces = lo 100.64.0.0/10 [share$] # The trailing dollar sign makes it hidden path = /home/user/share read only = no valid user = user hosts allow = 100.64.0.0/10 # Clients on the same Tailnet will have the same IP range Conclusion In conclusion, it is not advisable to serve SMB over the internet due to security concerns. However, by using Tailscale, the hosts allow parameter, and hidden share, it is possible to securely serve SMB to clients within a specific network. While Tailscale’s access control can be used to implement more stringent access control lists (ACLs), it was not necessary in my case as I was the only user.\n","wordCount":"784","inLanguage":"en","datePublished":"2023-01-04T18:14:39Z","dateModified":"2023-01-04T18:14:39Z","author":[{"@type":"Person","name":"Hartman"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://hartmantam.xyz/hidden/samba-over-tailscale-wireguard-old/"},"publisher":{"@type":"Organization","name":"(no title)","logo":{"@type":"ImageObject","url":"https://hartmantam.xyz/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://hartmantam.xyz/ accesskey=h title="(no title) (Alt + H)">(no title)</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://hartmantam.xyz/tech title=Tech><span>Tech</span></a></li><li><a href=https://hartmantam.xyz/about title=About><span>About</span></a></li><li><a href=https://hartmantam.xyz/tags title=Tags><span>Tags</span></a></li><li><a href=https://hartmantam.xyz/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Samba over Tailscale/Wireguard [Old]</h1><div class=post-meta><span title='2023-01-04 18:14:39 +0000 UTC'>January 4, 2023</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Hartman</div></header><div class=post-content><p>I recently found out about Tailscale, a control plane for WireGuard. I decided to revisit an old project of mine and use it to set up a Samba server on an long ignored dedicated server so that I could access my videos remotely. However, the process proved to be more challenging than I had anticipated.</p><h2 id=goal>Goal<a hidden class=anchor aria-hidden=true href=#goal>#</a></h2><p>The goal was to access my videos from the server via my Windows PC and Android phone, while also ensuring that the data was secure in transit, and not accessed by others. On my PC, I planned to use Windows&rsquo; native SMB support. On my Android phone, I intended to use the MX Player app to access the videos.</p><h2 id=problem>Problem<a hidden class=anchor aria-hidden=true href=#problem>#</a></h2><p>One of the main reasons I initially chose not to serve SMB over the internet was due to security concerns. While SMB is commonly used in LAN, it is not designed for use over the internet and may not provide adequate security when used in this manner. Additionally, the Android app I&rsquo;m using only supports SMB, so I had no other choice but to use it.</p><h2 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h2><p>The solution I came up with was to tunnel all Samba traffic through Tailnet, the WireGuard network managed by Tailscale. This way, I could benefit from the security provided by WireGuard and the authentication provided by Tailscale. Completing the goal of secure data in transit and authenticated access.</p><h3 id=alternate-solution>Alternate Solution<a hidden class=anchor aria-hidden=true href=#alternate-solution>#</a></h3><p>Another solution would have been to use a traditional VPN like OpenVPN, but this introduces a major drawback: all of my traffic would have to go through the VPN. While it is possible to use advanced configurations to avoid this issue, I did not have sufficient knowledge of networking to do so. When WireGuard first came out, I considered using it, but ultimately decided not to because I was unfamiliar with overlay networks and the work required to manage such a network.</p><h2 id=implementation>Implementation<a hidden class=anchor aria-hidden=true href=#implementation>#</a></h2><p>I won&rsquo;t go into detail on the process of setting up Samba or Tailscale, as I am not an expert in Samba configuration and Tailscale have a easy to follow quick start.</p><h3 id=initial-configuration>Initial Configuration<a hidden class=anchor aria-hidden=true href=#initial-configuration>#</a></h3><p>After consulting the documentation, I believed the following configuration would be sufficient:</p><pre tabindex=0><code>[global]
    
    interfaces = lo tailnet0        # Listens on Tailscale and loopback interface
    bind interfaces only = yes      # Only listen

[share]
    path = /home/user/share
    read only = no
    valid user = user               # Defense in depth, more layer protection is always better
</code></pre><h3 id=debugging-the-issue>Debugging the Issue<a hidden class=anchor aria-hidden=true href=#debugging-the-issue>#</a></h3><p>Unfortunately, this configuration did not work as expected. The Samba server did not bind to the Tailscale interface. Upon further investigation, I read a
<a href=https://unix.stackexchange.com/a/613409 target=_blank>post on Unix StackExchange</a> that Samba will not listen Wireguard interface unless IP and netmask are given. As a result, I modified the configuration as follows:</p><pre tabindex=0><code>[global]
    interfaces = lo 100.64.0.0/10   # 100.64.0.0/10 is the IP range that Tailscale assigns
    bind interfaces only = yes

[share]
    path = /home/user/share
    read only = no
    valid user = user
</code></pre><p>Sadly, this modification did not resolve the issue and the Samba server still did not listen. Despite spending two days trying to resolve the problem, I reread the documentation and discovered the following information regarding the <code>bind interface only</code> parameter:</p><blockquote><p>&mldr; Note that you should not use this parameter for machines that are serving PPP or other intermittent or non-broadcast network interfaces as it will not cope with non-permanent interfaces. &mldr;</p></blockquote><h2 id=final-configuration>Final Configuration<a hidden class=anchor aria-hidden=true href=#final-configuration>#</a></h2><p>This led me to realize that the <code>bind interfaces only</code> parameter was causing the issue. However, simply disabling it would cause the server to listen on every broadcast-capable interface in addition to the Tailscale interface.</p><p>To minimize the effect, I decided to use the <code>hosts allow</code> parameter to restrict access to only clients on the same Tailscale network and enable hidden share. However, this is not a perfect solution. Upon port scan, one can still see the server have Samba installed. People can still visit the root directory, although they can&rsquo;t see any share. Still, I deemed it should be sufficient for meeting my goal.</p><p>The final configuration I used is shown below:</p><pre tabindex=0><code>[global]
    interfaces = lo 100.64.0.0/10

[share$]                            # The trailing dollar sign makes it hidden
    path = /home/user/share
    read only = no
    valid user = user
    hosts allow = 100.64.0.0/10     # Clients on the same Tailnet will have the same IP range
</code></pre><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>In conclusion, it is not advisable to serve SMB over the internet due to security concerns. However, by using Tailscale, the hosts allow parameter, and hidden share, it is possible to securely serve SMB to clients within a specific network. While Tailscale&rsquo;s access control can be used to implement more stringent access control lists (ACLs), it was not necessary in my case as I was the only user.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://hartmantam.xyz/tags/server/>server</a></li><li><a href=https://hartmantam.xyz/tags/samba/>samba</a></li><li><a href=https://hartmantam.xyz/tags/tailscale/>tailscale</a></li><li><a href=https://hartmantam.xyz/tags/wireguard/>wireguard</a></li></ul></footer></article></main><footer class=footer><span>This work is licensed under a
<a href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="noopener noreferrer">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>